<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Varela+Round&display=swap" rel="stylesheet">
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; background-color: #F8F8F8; }
      form 
      { background: #E8E8E8; 
        padding: 3px; 
        position: fixed; 
        bottom: 0; 
        width: 60%;
        border-radius: 4px;
        margin-left: 300px;
        margin-right: 120px;}
      form input 
      { border: 0; 
        padding: 10px; 
        width: 90%;
        margin: 0px 0px 9px 7px;}
      /* .material-icons.md-36 { font-size: 36px;  } */
      form button { width: 9%; background-color: transparent; border: 0; padding-top: 5px;}
      form button:hover { cursor: pointer; 
        box-shadow: 0 9px 9px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);}
      #messages { list-style-type: none; margin: 0; padding: 0; font-family: 'Varela Round'; }
      #messages li { border: 2px solid #dedede;
        background-color: #f1f1f1;
        border-radius: 5px;
        padding-top: 10px;
        padding-bottom: 10px;
        padding-left: 10px;
        padding-right: 10px; 
        /*margin: 20px 120px 15px 300px; */
        margin-top: 20px;
        margin-bottom: 20px;
        box-shadow: 0 1px 1px 0 rgba(10, 10, 10, 0.11), 0 5px 5px 0 rgba(0, 0, 0, 0.137);
        /* float: left; */ 
        display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
      }
      #messages li:nth-child(odd) { border-color: #ccc;
        background-color: #ddd;
        /* float: right; */
       }
      /* .text-box li:nth-child(odd) {
        clear:left;
      } */
      header { text-align: left; padding-top: 5px; padding-bottom: 5px; padding-left: 25px; 
        background-color:black; color:white; font-family: 'Varela Round', sans-serif;
        border-radius: 1px; box-shadow: 5px 5px dimgray;}
      .text-box {
        float:left;
      } 
      .users-online {
        float: left;
        /* position: fixed; */
        background-color: #E8E8E8;
        border-radius: 10px;
        margin-top: 20px;
        margin-left: 20px;
        box-shadow: 0 1px 1px 0 rgba(10, 10, 10, 0.11), 0 5px 5px 0 rgba(0, 0, 0, 0.137);
        font-family: 'Varela Round';
      }
      .col1 .col2 {
        float :left;
        width: 10%;
      }
      .col1 {
        padding : 40px;
        height: 500px;
      }
      li {
        list-style-type: none;
      }

      ul li {
        padding-top: 5px;
        padding-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <header>
      <h3>Chat</h3>
    </header>

    <div class = "users-online col1">
      <!-- <ul>
        <li>Usager 1</li>
        <li>Usager 2</li>
      </ul> -->
    </div>

    <div class = "text-box">
      <ul id="messages">
      </ul>
    </div>

    
    <div class = "text-box col2">
      <ul id="messages" class = "test"></ul>
    </div>
    <form action="">
      <input id="m" autocomplete="off" /><button class="material-icons md-36">send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      //console.log("IN THE HTML CONSOLE!")
      $(function () {
        const socket = io('http://localhost:3000');
        const name = prompt("What is your name?");
        document.querySelector(".users-online").innerHTML += "<ul> <li>";
        document.querySelector(".users-online").innerHTML += name;
        document.querySelector(".users-online").innerHTML += "</li> </ul>";
        socket.emit('new-user', name);
        $('form').submit(function(e){
          e.preventDefault(); // prevents page reloading
          socket.emit('chat message', $('#m').val());
          $('#messages').append($('<li>').text("You: " + $('#m').val()))
          $('#m').val('');
          return false;
        });
        socket.on('chat message', function(data){
          console.log(data.name)
          $('#messages').append($('<li>').text(`${data.name}: ${data.message}`));
        });
        socket.on('user-connected', name => {
          $('#messages').append($('<li>').text(name + " just connected."));
          $('.users-online').append($('<ul><li>').text(name));
        })
      });
    </script>
  </body>
</html>
